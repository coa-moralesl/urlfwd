<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>URL Forwarder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h1 {
      color: #333;
    }
    .form-group {
      margin-bottom: 15px;
    }
    button {
      margin-top: 10px;
    }
    .guide {
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    .notice {
      font-size: 0.9em;
      color: #555;
      margin-top: 20px;
    }
    .copy-notification {
      color: green;
      margin-top: 10px;
      display: none;
    }
  </style>
</head>
<body>

  <h1>URL Forwarder</h1>

  <div class="guide">
    <h2>How to Use This Page</h2>
    <ol>
      <li>Select the protocol type from the dropdown: <strong>http</strong>, <strong>https</strong>, <strong>tel</strong>, <strong>companyportal</strong>, or <strong>other</strong> (to specify a custom protocol).</li>
      <li>Enter the remainder of the URL (or phone number for TEL) in the Input field.</li>
      <li>If you select <strong>other</strong>, an additional field will appear so you can enter your custom protocol (e.g., <code>myproto://</code>).</li>
      <li>Click the <strong>Generate URL and Copy to Clipboard</strong> button. The generated URL will appear below and be automatically copied to your clipboard.</li>
      <li>You can click <strong>Test URL</strong> to open the generated URL in a new tab. After the new tab opens, this page will attempt to close.</li>
    </ol>
  </div>

  <div id="formContainer">
    <div class="form-group">
      <label for="typeSelect">Select Protocol:</label>
      <select id="typeSelect">
        <option value="http">http</option>
        <option value="https">https</option>
        <option value="tel">tel</option>
        <option value="companyportal">companyportal</option>
        <option value="other">other</option>
      </select>
    </div>
    <div class="form-group">
      <label for="inputField">Input:</label>
      <input type="text" id="inputField" placeholder="Enter URL/number/path" />
    </div>
    <div class="form-group" id="customProtocolContainer" style="display: none;">
      <label for="customProtocolField">Custom Protocol (e.g., myproto://):</label>
      <input type="text" id="customProtocolField" placeholder="Enter custom protocol" />
    </div>
    <button id="generateButton">Generate URL and Copy to Clipboard</button>
  </div>

  <div class="form-group" id="outputContainer" style="display:none;">
    <label for="outputField">Generated URL:</label>
    <input type="text" id="outputField" readonly />
    <button id="testButton">Test URL</button>
    <div class="copy-notification" id="copyNotification">URL copied to clipboard!</div>
  </div>

  <div class="notice">
    <p>This page was created for the use of City of Austin | Capital Delivery Services | Technology Services Division and generated by L. Morales.</p>
  </div>

  <script>
    // Attempt to close the window (note: this will only work if the window was opened via script)
    function closeWindow() {
      // Some browsers require setting the window's opener to null first.
      window.opener = null;
      window.open('', '_self');
      window.close();
    }

    // Redirect if query parameters exist on page load and attempt to close the page after redirecting
    function redirectToURL() {
      const urlParams = new URLSearchParams(window.location.search);
      let newUrl = '';
      if (urlParams.has('http')) {
        const value = decodeURIComponent(urlParams.get('http'));
        newUrl = value.startsWith('http://') ? value : `http://${value}`;
      } else if (urlParams.has('https')) {
        const value = decodeURIComponent(urlParams.get('https'));
        newUrl = value.startsWith('https://') ? value : `https://${value}`;
      } else if (urlParams.has('tel')) {
        const value = decodeURIComponent(urlParams.get('tel'));
        newUrl = `tel:${value}`;
      } else if (urlParams.has('companyportal')) {
        const value = decodeURIComponent(urlParams.get('companyportal'));
        newUrl = `companyportal:${value}`;
      } else if (urlParams.has('other')) {
        const value = decodeURIComponent(urlParams.get('other'));
        newUrl = value;
      }
      if (newUrl) {
        window.location.href = newUrl;
        // Wait a moment before attempting to close the page
        setTimeout(closeWindow, 1000);
      }
    }

    // Show/hide custom protocol field based on dropdown selection
    document.getElementById('typeSelect').addEventListener('change', function() {
      const type = this.value;
      document.getElementById('customProtocolContainer').style.display = (type === 'other') ? 'block' : 'none';
    });

    // Generate URL and copy to clipboard
    document.getElementById('generateButton').addEventListener('click', function() {
      const type = document.getElementById('typeSelect').value;
      const input = document.getElementById('inputField').value.trim();
      const domain = window.location.origin;
      const path = window.location.pathname;
      let outputUrl = '';

      if (type === 'http') {
        outputUrl = `${domain}${path}?http=${encodeURIComponent(input)}`;
      } else if (type === 'https') {
        outputUrl = `${domain}${path}?https=${encodeURIComponent(input)}`;
      } else if (type === 'tel') {
        outputUrl = `${domain}${path}?tel=${encodeURIComponent(input)}`;
      } else if (type === 'companyportal') {
        outputUrl = `${domain}${path}?companyportal=${encodeURIComponent(input)}`;
      } else if (type === 'other') {
        const customProtocol = document.getElementById('customProtocolField').value.trim();
        outputUrl = `${domain}${path}?other=${encodeURIComponent(customProtocol + input)}`;
      }

      // Display the generated URL
      document.getElementById('outputField').value = outputUrl;
      document.getElementById('outputContainer').style.display = 'block';

      // Copy URL to clipboard
      copyToClipboard(outputUrl);
    });

    // Copy helper function
    function copyToClipboard(text) {
      const tempInput = document.createElement('input');
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);

      const notification = document.getElementById('copyNotification');
      notification.style.display = 'block';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // Test URL button: open generated URL in a new tab and close the current window
    document.getElementById('testButton').addEventListener('click', function() {
      const testUrl = document.getElementById('outputField').value;
      window.open(testUrl, '_blank');
      // Attempt to close this window after opening the new tab
      setTimeout(closeWindow, 500);
    });

    window.onload = redirectToURL;
  </script>

</body>
</html>
