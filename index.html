<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>URL Forwarder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h1 {
      color: #333;
    }
    .form-group {
      margin-bottom: 15px;
    }
    button {
      margin-top: 10px;
    }
    .guide, .notice {
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    .copy-notification {
      color: green;
      margin-top: 10px;
      display: none;
    }
    /* Container for the redirection message */
    #redirectContainer {
      display: none;
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      border-radius: 5px;
      text-align: center;
    }
  </style>
</head>
<body>

  <!-- Main Content Container -->
  <div id="mainContent">
    <h1>URL Forwarder</h1>

    <div class="guide">
      <h2>How to Use This Page</h2>
      <ol>
        <li>Select the protocol type from the dropdown: <strong>http</strong>, <strong>https</strong>, <strong>tel</strong>, <strong>companyportal</strong>, or <strong>other</strong> (to specify a custom protocol).</li>
        <li>Enter the remainder of the URL (or phone number for TEL) in the Input field.</li>
        <li>If you select <strong>other</strong>, an additional field will appear so you can enter your custom protocol (e.g., <code>myproto://</code>).</li>
        <li>Click the <strong>Generate URL and Copy to Clipboard</strong> button. The generated URL will appear below and be automatically copied to your clipboard.</li>
        <li>You can click <strong>Test URL</strong> to open the generated URL in the same page.</li>
      </ol>
    </div>

    <div id="formContainer">
      <div class="form-group">
        <label for="typeSelect">Select Protocol:</label>
        <select id="typeSelect">
          <option value="http">http</option>
          <option value="https">https</option>
          <option value="tel">tel</option>
          <option value="companyportal">companyportal</option>
          <option value="other">other</option>
        </select>
      </div>
      <div class="form-group">
        <label for="inputField">Input:</label>
        <input type="text" id="inputField" placeholder="Enter URL/number/path" />
      </div>
      <div class="form-group" id="customProtocolContainer" style="display: none;">
        <label for="customProtocolField">Custom Protocol (e.g., myproto://):</label>
        <input type="text" id="customProtocolField" placeholder="Enter custom protocol" />
      </div>
      <button id="generateButton">Generate URL and Copy to Clipboard</button>
    </div>

    <div class="form-group" id="outputContainer" style="display:none;">
      <label for="outputField">Generated URL:</label>
      <input type="text" id="outputField" readonly />
      <button id="testButton">Test URL</button>
      <div class="copy-notification" id="copyNotification">URL copied to clipboard!</div>
    </div>

    <div class="notice">
      <p>This page was created for the use of City of Austin | Capital Delivery Services | Technology Services Division and generated by L. Morales.</p>
    </div>
  </div>

  <!-- Redirection/Countdown Message Container -->
  <div id="redirectContainer"></div>

  <script>
    // Determine the target URL based on query parameters.
    function getRedirectUrl() {
      const urlParams = new URLSearchParams(window.location.search);
      let redirectUrl = '';
      if (urlParams.has('http')) {
        const value = decodeURIComponent(urlParams.get('http'));
        redirectUrl = value.startsWith('http://') ? value : `http://${value}`;
      } else if (urlParams.has('https')) {
        const value = decodeURIComponent(urlParams.get('https'));
        redirectUrl = value.startsWith('https://') ? value : `https://${value}`;
      } else if (urlParams.has('tel')) {
        const value = decodeURIComponent(urlParams.get('tel'));
        redirectUrl = `tel:${value}`;
      } else if (urlParams.has('companyportal')) {
        const value = decodeURIComponent(urlParams.get('companyportal'));
        redirectUrl = `companyportal:${value}`;
      } else if (urlParams.has('other')) {
        const value = decodeURIComponent(urlParams.get('other'));
        redirectUrl = value;
      }
      return redirectUrl;
    }

    // Show the redirection message with countdown and a close button.
    function showRedirectMessage(redirectUrl) {
      // Hide main UI
      document.getElementById('mainContent').style.display = 'none';
      
      // Prepare the redirect container content
      const container = document.getElementById('redirectContainer');
      container.style.display = 'block';
      container.innerHTML = `
        <p>You are being forwarded to <a href="${redirectUrl}" target="_blank">${redirectUrl}</a>.</p>
        <p>This window will close in <span id="countdown">10</span> seconds.</p>
        <button id="closeButton">Close Now</button>
      `;

      // Optionally, open the target URL in a new tab
      window.open(redirectUrl, '_blank');

      // Start the countdown
      let seconds = 10;
      const countdownEl = document.getElementById('countdown');
      const intervalId = setInterval(() => {
        seconds--;
        countdownEl.textContent = seconds;
        if (seconds <= 0) {
          clearInterval(intervalId);
          window.close();
        }
      }, 1000);

      // Allow manual close
      document.getElementById('closeButton').addEventListener('click', () => {
        clearInterval(intervalId);
        window.close();
      });
    }

    // Handle redirection logic on page load.
    function handleRedirection() {
      const redirectUrl = getRedirectUrl();
      if (redirectUrl) {
        showRedirectMessage(redirectUrl);
      }
    }

    // Show/hide custom protocol field based on dropdown selection.
    document.getElementById('typeSelect').addEventListener('change', function() {
      const customProtocolContainer = document.getElementById('customProtocolContainer');
      customProtocolContainer.style.display = (this.value === 'other') ? 'block' : 'none';
    });

    // Generate URL and copy to clipboard.
    document.getElementById('generateButton').addEventListener('click', function() {
      const type = document.getElementById('typeSelect').value;
      const input = document.getElementById('inputField').value.trim();
      const domain = window.location.origin;
      const path = window.location.pathname;
      let outputUrl = '';

      if (type === 'http') {
        outputUrl = `${domain}${path}?http=${encodeURIComponent(input)}`;
      } else if (type === 'https') {
        outputUrl = `${domain}${path}?https=${encodeURIComponent(input)}`;
      } else if (type === 'tel') {
        outputUrl = `${domain}${path}?tel=${encodeURIComponent(input)}`;
      } else if (type === 'companyportal') {
        outputUrl = `${domain}${path}?companyportal=${encodeURIComponent(input)}`;
      } else if (type === 'other') {
        const customProtocol = document.getElementById('customProtocolField').value.trim();
        outputUrl = `${domain}${path}?other=${encodeURIComponent(customProtocol + input)}`;
      }

      document.getElementById('outputField').value = outputUrl;
      document.getElementById('outputContainer').style.display = 'block';
      copyToClipboard(outputUrl);
    });

    // Helper function to copy text to clipboard.
    function copyToClipboard(text) {
      const tempInput = document.createElement('input');
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
      const notification = document.getElementById('copyNotification');
      notification.style.display = 'block';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }

    // Test URL button.
    document.getElementById('testButton').addEventListener('click', function() {
      const testUrl = document.getElementById('outputField').value;
      window.location.href = testUrl;
    });

    window.onload = handleRedirection;
  </script>

</body>
</html>
