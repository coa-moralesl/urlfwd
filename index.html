<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>URL Forwarder</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    h1, h2 {
      color: #333;
    }
    .form-group {
      margin-bottom: 15px;
    }
    button {
      margin-top: 10px;
    }
    .guide {
      background-color: #fff;
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 5px;
    }
    .notice {
      font-size: 0.9em;
      color: #555;
      margin-top: 20px;
    }
    .copy-notification {
      color: green;
      margin-top: 10px;
      display: none;
    }
    /* Redirection panel styles */
    #redirContainer {
      display: none;
      background-color: #fff;
      border: 2px solid #4CAF50;
      padding: 20px;
      border-radius: 5px;
    }
    #redirContainer iframe {
      width: 100%;
      height: 400px;
      border: none;
      margin-top: 15px;
    }
  </style>
</head>
<body>

  <!-- Main content container (for generating URLs) -->
  <div id="mainContainer">
    <h1>URL Forwarder</h1>
  
    <div class="guide">
      <h2>How to Use This Page</h2>
      <ol>
        <li>Select the protocol type from the dropdown: <strong>http</strong>, <strong>https</strong>, <strong>tel</strong>, <strong>companyportal</strong>, or <strong>other</strong> (to specify a custom protocol).</li>
        <li>Enter the remainder of the URL (or phone number for TEL) in the Input field.</li>
        <li>If you select <strong>other</strong>, an additional field will appear so you can enter your custom protocol (e.g., <code>myproto://</code>).</li>
        <li>Click the <strong>Generate URL and Copy to Clipboard</strong> button. The generated URL will appear below and be automatically copied to your clipboard.</li>
        <li>You can click <strong>Test URL</strong> to open the generated URL in the same page.</li>
      </ol>
    </div>
  
    <div id="formContainer">
      <div class="form-group">
        <label for="typeSelect">Select Protocol:</label>
        <select id="typeSelect">
          <option value="http">http</option>
          <option value="https">https</option>
          <option value="tel">tel</option>
          <option value="companyportal">companyportal</option>
          <option value="other">other</option>
        </select>
      </div>
      <div class="form-group">
        <label for="inputField">Input:</label>
        <input type="text" id="inputField" placeholder="Enter URL/number/path" />
      </div>
      <div class="form-group" id="customProtocolContainer" style="display: none;">
        <label for="customProtocolField">Custom Protocol (e.g., myproto://):</label>
        <input type="text" id="customProtocolField" placeholder="Enter custom protocol" />
      </div>
      <button id="generateButton">Generate URL and Copy to Clipboard</button>
    </div>
  
    <div class="form-group" id="outputContainer" style="display:none;">
      <label for="outputField">Generated URL:</label>
      <input type="text" id="outputField" readonly />
      <button id="testButton">Test URL</button>
      <div class="copy-notification" id="copyNotification">URL copied to clipboard!</div>
    </div>
  
    <div class="notice">
      <p>This page was created for the use of City of Austin | Capital Delivery Services | Technology Services Division and generated by L. Morales.</p>
    </div>
  </div>
  
  <!-- Redirection view container -->
  <div id="redirContainer">
    <h2>Redirecting...</h2>
    <p>You are being redirected to: <strong id="redirUrl"></strong></p>
    <p>This window will close in <span id="countdown">5</span> second(s).</p>
    <p>If the window does not close automatically, click the button below.</p>
    <button id="closeButton" onclick="closeWindow()">Close Now</button>
    <!-- Embedded preview of the destination page -->
    <iframe id="redirIframe" src=""></iframe>
  </div>
  
  <script>
    // Function to show the redirection view
    function showRedirPage(dest) {
      // Hide the main content
      document.getElementById('mainContainer').style.display = 'none';
      // Show the redirection container
      document.getElementById('redirContainer').style.display = 'block';
      // Set the destination URL in text and in the iframe preview
      document.getElementById('redirUrl').textContent = dest;
      document.getElementById('redirIframe').src = dest;
  
      // Start a 5-second countdown
      let seconds = 5;
      const countdownElem = document.getElementById('countdown');
      countdownElem.textContent = seconds;
      const interval = setInterval(function() {
        seconds--;
        countdownElem.textContent = seconds;
        if (seconds <= 0) {
          clearInterval(interval);
          // Attempt to close the window
          closeWindow();
        }
      }, 1000);
    }
  
    // Helper function to close the window
    function closeWindow() {
      window.close();
      // In case window.close() doesn't work, you might notify the user.
    }
  
    // Function to check for redirection or other parameters and act accordingly
    function redirectToURL() {
      const urlParams = new URLSearchParams(window.location.search);
  
      // If a redir parameter is provided, show the redirection view with countdown.
      if (urlParams.has('redir')) {
        const dest = decodeURIComponent(urlParams.get('redir'));
        showRedirPage(dest);
        return;
      }
  
      // Otherwise, check for other parameters and perform immediate redirection.
      if (urlParams.has('tel')) {
        const tel = decodeURIComponent(urlParams.get('tel'));
        window.location.href = `tel:${tel}`;
      } else if (urlParams.has('https')) {
        const url = decodeURIComponent(urlParams.get('https'));
        const secureUrl = url.startsWith('http://') ? url.replace('http://', 'https://') : url;
        window.location.href = secureUrl.startsWith('https://') ? secureUrl : `https://${secureUrl}`;
      } else if (urlParams.has('http')) {
        const url = decodeURIComponent(urlParams.get('http'));
        window.location.href = url.startsWith('http://') ? url : `http://${url}`;
      } else if (urlParams.has('companyportal')) {
        const cp = decodeURIComponent(urlParams.get('companyportal'));
        window.location.href = `companyportal:${cp}`;
      } else if (urlParams.has('other')) {
        const other = decodeURIComponent(urlParams.get('other'));
        window.location.href = other;
      }
    }
  
    // Show/hide custom protocol field based on dropdown selection
    document.getElementById('typeSelect').addEventListener('change', function() {
      const type = this.value;
      const customProtocolContainer = document.getElementById('customProtocolContainer');
      customProtocolContainer.style.display = (type === 'other') ? 'block' : 'none';
    });
  
    // Generate URL and copy to clipboard
    document.getElementById('generateButton').addEventListener('click', function() {
      const type = document.getElementById('typeSelect').value;
      const input = document.getElementById('inputField').value.trim();
      const domain = window.location.origin;
      const path = window.location.pathname;
      let outputUrl = '';
  
      if (type === 'http') {
        outputUrl = `${domain}${path}?http=${encodeURIComponent(input)}`;
      } else if (type === 'https') {
        outputUrl = `${domain}${path}?https=${encodeURIComponent(input)}`;
      } else if (type === 'tel') {
        outputUrl = `${domain}${path}?tel=${encodeURIComponent(input)}`;
      } else if (type === 'companyportal') {
        outputUrl = `${domain}${path}?companyportal=${encodeURIComponent(input)}`;
      } else if (type === 'other') {
        const customProtocol = document.getElementById('customProtocolField').value.trim();
        outputUrl = `${domain}${path}?other=${encodeURIComponent(customProtocol + input)}`;
      }
  
      // Display the generated URL
      document.getElementById('outputField').value = outputUrl;
      document.getElementById('outputContainer').style.display = 'block';
  
      // Automatically copy the URL to clipboard
      copyToClipboard(outputUrl);
    });
  
    // Copy helper function
    function copyToClipboard(text) {
      const tempInput = document.createElement('input');
      tempInput.value = text;
      document.body.appendChild(tempInput);
      tempInput.select();
      document.execCommand('copy');
      document.body.removeChild(tempInput);
  
      const notification = document.getElementById('copyNotification');
      notification.style.display = 'block';
      setTimeout(() => {
        notification.style.display = 'none';
      }, 3000);
    }
  
    // Test URL button functionality
    document.getElementById('testButton').addEventListener('click', function() {
      const testUrl = document.getElementById('outputField').value;
      window.location.href = testUrl;
    });
  
    // On window load, handle redirection if parameters are present.
    window.onload = redirectToURL;
  </script>
  
</body>
</html>
